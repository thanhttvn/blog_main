
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>
    Phân tích cây quyết định với scikit-learn | Code từ đâu - Code từ đầu
    </title>

    

    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" href="../favicon.png">

    <!--<link rel="stylesheet" type="text/css" href="/assets/css/screen.css?v=2fec92af86" />-->

    <link rel="stylesheet" href="../assets/css/bootstrap.min.css?v=2fec92af86">
    <link rel="stylesheet" href="../assets/css/monokai_sublime.css?v=2fec92af86">
    <link rel="stylesheet" href="../assets/css/default.css?v=2fec92af86">
<link rel="stylesheet" href="../assets/css/elusive-icons.min.css?v=2fec92af86">

    <link rel="shortcut icon" href="../favicon.png" type="image/png">
    <link rel="canonical" href="index.html">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="amphtml" href="amp/index.html">
    
    <meta property="og:site_name" content="Code từ đâu - Code từ đầu">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Phân tích cây quyết định với scikit-learn">
    <meta property="og:description" content="Trong họ hàng nhà cây quyết định có 2 loại:
 Cây hồi quy (`Regression tree`)
Cây phân loại (`Classification tree`)
">
    <meta property="og:url" content="http://codetudau.com/phan-tich-cay-quyet-dinh-voi-scikit-learn/">
    <meta property="article:published_time" content="2017-09-03T09:11:37.000Z">
    <meta property="article:modified_time" content="2017-09-03T09:11:37.000Z">
    <meta property="article:tag" content="BIG DATA">
    <meta property="article:tag" content="python">
    <meta property="article:tag" content="scikit-learn">
    <meta property="article:tag" content="Decision Tree">
    
    <meta property="article:publisher" content="https://www.facebook.com/passion1907">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Phân tích cây quyết định với scikit-learn">
    <meta name="twitter:description" content="Trong họ hàng nhà cây quyết định có 2 loại:
 Cây hồi quy (`Regression tree`)
Cây phân loại (`Classification tree`)
">
    <meta name="twitter:url" content="http://codetudau.com/phan-tich-cay-quyet-dinh-voi-scikit-learn/">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="T.T.T">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="BIG DATA, python, scikit-learn, Decision Tree">
    <meta name="twitter:site" content="@AdwardVn">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Code từ đâu - Code từ đầu",
        "logo": "http://codetudau.com/content/images/2017/08/kkkkkkkk.png"
    },
    "author": {
        "@type": "Person",
        "name": "T.T.T",
        "url": "http://codetudau.com/author/t/",
        "sameAs": []
    },
    "headline": "Phân tích cây quyết định với scikit-learn",
    "url": "http://codetudau.com/phan-tich-cay-quyet-dinh-voi-scikit-learn/",
    "datePublished": "2017-09-03T09:11:37.000Z",
    "dateModified": "2017-09-03T09:11:37.000Z",
    "keywords": "BIG DATA, python, scikit-learn, Decision Tree",
    "description": "Trong họ hàng nhà cây quyết định có 2 loại:\n Cây hồi quy (&#x60;Regression tree&#x60;)\nCây phân loại (&#x60;Classification tree&#x60;)\n",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://codetudau.com/"
    }
}
    </script>

    <script type="text/javascript" src="../public/ghost-sdk.js?v=2fec92af86"></script>
<script type="text/javascript">
ghost.init({
	clientId: "ghost-frontend",
	clientSecret: "2575335f4165"
});
</script>
    <meta name="generator" content="Ghost 1.7">
    <link rel="alternate" type="application/rss+xml" title="Code từ đâu - Code từ đầu" href="../rss/index.html">

<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-40547934-3', 'auto');
  ga('send', 'pageview');

</script>
        <script type="text/javascript" src="../assets/js/jquery.js?v=2fec92af86"></script>

    <!--<link rel="stylesheet" href="/assets/css/default.css?v=2fec92af86">-->
    
    <script src="../assets/js/highlight.pack.js?v=2fec92af86"></script>
  
      <script>hljs.initHighlightingOnLoad();</script>


<script>

</script>
</head>
<body>
<div class="container">
<div class="row">
<div class="col-md-2 hidden-sm hidden-xs">

    <div class="logo">
<a class="blog-logo" href="../">
        <img class="blog-logo-image" src="../content/images/2017/08/kkkkkkkk.png" alt="Blog Logo">
</a>
    </div>


<h5>Code từ đâu - Code từ đầu</h5>
<hr>
<ul class="list-unstyled menu">
    <li>
        <a href="https://github.com/thanhttvn" target="_blank">
         <i class="el el-github"></i> GitHub
        </a>
    </li>

        <li>
            <a href="https://www.facebook.com/passion1907" target="_blank">
                <i class="el el-facebook"></i> Facebook
            </a>
        </li>

        <li>
            <a href="https://twitter.com/AdwardVn" target="_blank">
                <i class="el el-twitter"></i> @AdwardVn
            </a>
        </li>

    <li>
        <a href="skype:thanhtt.vn93?add" target="_blank">
            <i class="el el-skype"></i> thanhtt.vn93
        </a>

    </li>
</ul>



</div>
<div class="col-md-10 col-xs-12">
    

<a href="../" class="read-more"><i class="el el-caret-left read-more"></i> home</a>
<hr>





<main role="main">

    <article class="row post tag-bigdata tag-python tag-scikit-learn tag-decision-tree">

        <header class="col-xs-12">
        <div class="col-md-10 no-margin no-padding post">
            <h1 class="title">
            Phân tích cây quyết định với scikit-learn

            </h1>
             </div>
<div class="col-md-2">
            </div>

        </header>

        <section class="col-xs-12">
            <div class="kg-card-markdown"><p>Phân tích cây quyết định (Decision Tree Analysis)<br>
Cây quyết định là một phương pháp phổ biến trong việc khai phá dữ liệu. Cây quyết định là mô hình hỗ trợ ra quyết định dựa trên đồ thị các điều kiện. Tại mỗi nút, ta sẽ đối chiếu các điều kiện thực tế để quyết định rẽ nhánh nào. Nút lá là quyết định cuối cùng.</p>
<p>Trong họ hàng nhà cây quyết định có 2 loại:</p>
<ul>
<li>Cây hồi quy (<code>Regression tree</code>) ước lượng các hàm giá có giá trị là số thực thay vì được sử dụng cho các nhiệm vụ phân loại. (ví dụ: ước tính giá một ngôi nhà hoặc khoảng thời gian một bệnh nhân nằm viện)</li>
<li>Cây phân loại (<code>Classification tree</code>), phân loại như: giới tính (nam hay nữ), kết quả của một trận đấu (thắng hay thua).</li>
</ul>
<p>Vậy nó có ưu điểm gì không ?</p>
<h1 id="uimcavicphntchcyquytnh">Ưu điểm của việc phân tích cây quyết định</h1>
<p>So với các các phân tích dữ liệu khác thì việc sử dụng cây quyết định có các ưu điểm như sau:</p>
<ul>
<li>Học những đặc trưng từ data đầu vào, đầu ra là kết quả với hình dạng cây quyết định. Nghĩa là dễ dàng nhìn thấy đặc trưng của data đầu vào.</li>
<li>Các loại phương pháp khác cần công việc tiền xử lý rất nhiều, còn với cây quyết định thì hầu như là không cần công đoạn tiền xử lý.</li>
<li>Với các loại phân tích như Neural Network được coi như kiểu model hộp đen (nói đơn giản là bạn không hiểu trong hộp có gì, xử lý ra sao) thì Decision Tree giống như model hộp trắng.</li>
<li>Hỗ trợ đánh giá độ chính xác của các model được tạo ra. Ở đây các model chính là các cây quyết định được tạo trong quá trình xử lý theo phương pháp này.</li>
</ul>
<h1 id="thuttoncyquytnh">Thuật toán cây quyết định</h1>
<p>Để phân tích cây quyết định thì có khá nhiều phương pháp, sự khác nhau như sau:</p>
<ul>
<li>ID3<br>
ID3 (Iterative Dichotomiser 3) được phát triển vào nào 1986 bởi Ross Quinlan. Sử dụng lượng thông tin ứng với biến số phân loại sau đó dùng kỹ thuật tham lam ( = lựa chọn tối ưu địa phương ở mỗi bước đi với hy vọng tìm được tối ưu toàn cục )<br>
Ví dụ như thuật toán tìm đường đi ngắn nhất của Dijkstra</li>
<li>C4.5<br>
Được phát triển từ ID3. C4.5 là thuật toán phân lớp dữ liệu dựa trên cây quyết định hiệu quả và phổ biến trong những ứng dụng khai phá cơ sở dữ liệu có kích thước nhỏ.<br>
So với ID3, C4.5 không cần biến số phân loại lượng đặc trưng. Output theo dạng if-then, không hiển thị những phần cành không cần thiết.</li>
<li>C5.0<br>
Là bản cải tiến của C4.5. Giúp cải thiện vấn đề hiệu năng và sử dụng ít bộ nhớ hơn.</li>
<li>CART<br>
CART (Classification and Regression Trees) khá giống với C4.5. Được phát triển bởi Breiman năm 1984. Tạo cây phân tích dựa trên biến phân loại, giải thích, mục đính và hồi quy. Và scikit-learn có chứa phiên bản tối ưu hoá của CART.</li>
</ul>
<h1 id="tocyquytnhtrnscikitlearn">Tạo cây quyết định trên scikit-learn</h1>
<p>Tạo ra mô hình cây quyết định dựa trên dữ liệu thực tế, sau đó tiến hành đánh giá các mô hình đó. Trên python, nếu sử dụng scikit-learn thì công việc rất dễ dàng bằng việc sử dụng class sklearn.tree.DecisionTreeClassifier</p>
<pre><code class="language-python">sklearn.tree.DecisionTreeClassifier(criterion='gini',
  splitter='best', max_depth=None, min_samples_split=2,
  min_samples_leaf=1, min_weight_fraction_leaf=0.0,
  max_features=None, random_state=None,
  max_leaf_nodes=None, class_weight=None, presort=False)
</code></pre>
<p>Lần này ví dụ sẽ sử dụng data Iris, có sẵn theo gói thư viện scikit-learn. Tiến hành phân loại hoa Iris, hay còn gọi là hoa cầu vồng, dựa theo độ rộng, dài của cánh hoa, cuống hoa. Hoa Iris rất đa dạng, tầm 150 loại. Chiều rộng, chiều dài của cánh hoa, tràng hoa sẽ là biến số giải thích, biến số mục đích là loại hoa để tiến hành tạo cây quyết định.</p>
<pre><code class="language-python">&gt;&gt;&gt; # load dữ liệu
&gt;&gt;&gt; from sklearn.datasets import load_iris
&gt;&gt;&gt; iris = load_iris()
 
&gt;&gt;&gt; # biến giải thích (tương ứng với chiều rộng, dài của đài hoa, cánh hoa)
&gt;&gt;&gt; iris.data
array([[ 5.1,  3.5,  1.4,  0.2],
       [ 4.9,  3. ,  1.4,  0.2],
       [ 4.7,  3.2,  1.3,  0.2],
       [ 4.6,  3.1,  1.5,  0.2],
        ... (lược bớt)
       [ 5.9,  3. ,  5.1,  1.8]])
 
&gt;&gt;&gt; # biến mục đích (0, 1, 2 tương ứng với 3 loại hoa)
&gt;&gt;&gt; iris.target
array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
       1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
       1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
       2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
       2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2])

</code></pre>
<p>Sau đó cắt data thành 2 phần: training data và test data.</p>
<pre><code class="language-python">from sklearn.model_selection import train_test_split
X_train, X_test, y_train, y_test = train_test_split( iris.data, iris.target, test_size = 0.3)
# test_size: 30% là test data còn lại 70% để làm train data.
</code></pre>
<p>Tiến hành tạo cây quyết định</p>
<pre><code class="language-python">&gt;&gt;&gt; # tạo model
&gt;&gt;&gt; from sklearn import tree
&gt;&gt;&gt; clf = tree.DecisionTreeClassifier(max_depth=3)
&gt;&gt;&gt; #max_depth = 3 là độ sâu của cây quyết định
&gt;&gt;&gt; clf = clf.fit(X_train, y_train)
</code></pre>
<p>Ok, giờ sử dụng model đã tạo phía trên tiến hành dự đoán kết quả loài hoa nào ứng với mỗi X_test(lưu biến giải thích).</p>
<pre><code class="language-python">&gt;&gt;&gt; # Thực hiện dự đoán kết quả từ những thông số biến giải thích đầu vào
&gt;&gt;&gt; predicted = clf.predict(X_test)
 
&gt;&gt;&gt; # Kết quả suy đoán
&gt;&gt;&gt; predicted
array([2, 0, 0, 2, 0, 2, 0, 0, 0, 2, 0, 0, 0, 1, 2, 0, 0, 1, 2, 0, 2, 2, 0,
       1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 0, 2, 0, 1, 1, 0, 1, 0, 2])

</code></pre>
<p>Không biết tỷ lệ đúng được bao nhiêu nhỉ. Chúng ta thử dùng phép chia đơn giản để biết. Thực tế có nhiều cách tính độ chính xác cũng như sai số của thuật toán nhưng mình sẽ giới thiệu ở các bài viết sau.</p>
<pre><code class="language-python">&gt;&gt;&gt; sum(predicted==y_test)/float(len(y_test))
0.93333333333333335
</code></pre>
<p>Vậy là độ chính xác của kết quả là ~93%. Rất tuyệt vời nhỉ :D</p>
<h1 id="hinthcyquytnh">Hiển thị cây quyết định</h1>
<p>Chúng ta có thể tạo cây quyết định dưới dạng file DOT. Và từ file DOT sẽ sử dụng <code>GraphViz</code> hoặc <code>webgraphviz</code> để mở.<br>
Như ví dụ sau, tên của các biến giải thích được setting như sau <code>feature_names=iris.feature_names</code>, tên của biến mục đích <code>class_names=iris.target_names</code>, muốn màu mè cho các nhánh thì setting <code>filled=True</code>, các góc của các nhánh bo tròn cho hoành tráng thì <code>rounded=True</code>.</p>
<pre><code class="language-python">&gt;&gt;&gt; tree.export_graphviz(clf, out_file="tree.dot",
                         feature_names=iris.feature_names,
                         class_names=iris.target_names,
                         filled=True, rounded=True)
</code></pre>
<p>Bạn sẽ tạo được file .dot, có thể dùng trang <a href="http://www.webgraphviz.com/">http://www.webgraphviz.com/</a> để convert sang ảnh như sau:<br>
<img src="../content/images/2017/09/----------2017-09-03-17.46.52.png" alt="----------2017-09-03-17.46.52"><br>
Hoặc dùng package <code>pydotplus</code> convert sang pdf, png tiện lợi hơn. Chưa có thì có thể dễ dàng install với pip.</p>
<pre><code class="language-python">pip install pydotplus
</code></pre>
<pre><code class="language-python">
&gt;&gt;&gt; # import package  pydotplus.
&gt;&gt;&gt; import pydotplus
&gt;&gt;&gt; dot_data = tree.export_graphviz(clf , out_file = None , filled = True , rounded = True , special_characters = True)
&gt;&gt;&gt; graph = pydotplus.graph_from_dot_data(dot_data)
&gt;&gt;&gt; graph.write_pdf("graph.pdf")
</code></pre>
<p><img src="../content/images/2017/09/----------2017-09-03-18.02.09.png" alt="----------2017-09-03-18.02.09"><br>
Vậy là đã có file <code>graph.pdf</code>, ngoài ra có thể tạo file png với <code>graph.write_png("graph.png")</code>.<br>
Với những người phân tích dữ liệu thì việc có thể quan sát cây quyết định rất tiện lợi cũng như nâng cao hiệu quả công việc đấy.</p>
</div>
        </section>

        <footer class="col-xs-12 author">
            
            <hr>

      
        </footer>

    </article>
    
    <!--<div id="disqus_thread" class="post"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = ''; // required: replace example with your forum shortname
        var disqus_identifier = '';

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>-->

</main>


</div>
        <div class="col-md-10 hidden-xs hidden-sm">
            <div class="subscribe-form">
                <form method="post" action="http://codetudau.com/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"><input class="location" type="hidden" name="location"><input class="referrer" type="hidden" name="referrer">

    <div class="form-group">
        <input class="subscribe-email" type="email" name="email">
    </div>
    <button class="" type="submit"><span>Subscribe</span></button>
    <script type="text/javascript">(function(g,h,o,s,t){h[o]('.location')[s]=h[o]('.location')[s] || g.location.href;h[o]('.referrer')[s]=h[o]('.referrer')[s] || h.referrer;})(window,document,'querySelector','value');</script>
</form>


            </div>
        </div>


</div>
</div>

    <footer class="page-footer">
      <div class="container">
        <div class="row">
          <div class="col-xs-6">
          <i class="el el-stop footer-icon"></i>
            © 2017 <a href="../">Code từ đâu - Code từ đầu</a> All rights reserved.<br><br>
            Coder Ghost Theme created by <a href="https://www.mbejda.com">Milos Bejda</a>
          </div>
          <div class="col-xs-6 text-right hidden-sm hidden-xs">Proudly published with <a href="https://ghost.org">Ghost</a></div>
        </div>
      </div>
    </footer>

    <a href="index.html#" class="back-to-top"><span class="fa fa-angle-up fa-2x"></span></a>

    

    <script src="../assets/js/modernizr.js?v=2fec92af86"></script>
    <script type="text/javascript" src="../assets/js/index.js?v=2fec92af86"></script>

</body>
